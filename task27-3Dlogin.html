<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>登陆|注册</title>
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css">
  <link rel="stylesheet" href="Task27.css">
</head>
<body>
   <header>
     <a class="login" href="#"><i class='fas fa-user-circle'></i></a>
   </header>
   <main>
     <div class="flip-modal login">
       <div class="modal modal-login">
          <a href="#" class="close fas fa-times"></a>
          <div class="tabs">
            <a href="#" class="login active">登陆</a>
            <a href="#" class="register">注册</a>
          </div>
          <div class="content">
            <div class="errormsg"></div>
            <form action="/login" method="post">
              <div class="input-field">
                <i class="far fa-user-circle"></i>
                <input type="text" name="username" placeholder="用户名">
              </div>
              <div class="input-field">
                <i class="fas fa-lock"></i>
                <input type="password" name="password" placeholder="密码">
              </div>
              <div class="input-field">
                <input type="submit" value="登陆">
              </div>
            </form>  
          </div> 
       </div>
       <div class="modal modal-register">
          <a href="#" class="close fas fa-times"></a>
          <div class="tabs">
            <a href="#" class="login">登陆</a>
            <a href="#" class="register active">注册</a>
          </div>
          <div class="content">
            <div class="errormsg"></div>
            <form action="/login" method="post">
              <div class="input-field">
                <i class="far fa-user-circle"></i>
                <input type="text" name="username" placeholder="用户名">
              </div>
              <div class="input-field">
                <i class="fas fa-lock"></i>
                <input type="password" name="password" placeholder="密码">
              </div>
              <div class="input-field">
                <i class="fas fa-lock"></i>
                <input type="password" name="password" placeholder="再次输入密码">
              </div>
              <div class="input-field">
                <input type="submit" value="注册">
              </div>
            </form>  
          </div> 
       </div>
     </div>
   </main>
   <script>
      function $(ele){
    return document.querySelector(ele)
      }
 function $$(ele){
    return document.querySelectorAll(ele)
      }

     /* $$('.modal .login').forEach(function(node){
        node.addEventListener('click',function(){
      $('.flip-modal').classList.remove('register'); 
     $('.flip-modal').classList.add('login')})
      })

      $$('.modal .register').forEach(function(node){
        node.addEventListener('click',function(){
      $('.flip-modal').classList.remove('login'); 
     $('.flip-modal').classList.add('register')})
      })*/
      
      
     $('header .fas').onclick=function(e){
       e.stopPropagation();
       $('.flip-modal').classList.add("show")
     }  

$('.flip-modal').addEventListener('click',function(e){ e.stopPropagation();
  if(e.target.classList.contains('login')){
     $('.flip-modal').classList.remove('register')
     $('.flip-modal').classList.add('login')
     }
  if(e.target.classList.contains('register')){
     $('.flip-modal').classList.remove('login')
     $('.flip-modal').classList.add('register')
} 
  if(e.target.classList.contains('close')){
    $('.flip-modal').classList.remove('show') 
  }
})
  document.addEventListener('click',function(){
     $('.flip-modal').classList.remove('show') 
  })
  
  $('.modal-login form').addEventListener("submit",function(e){
    e.preventDefault();
    if(!/^\w{3,8}$/.test($('.modal-login input[name=username]').value)){
      $('.modal-login .errormsg').innerText = '用户名需输入3-8个字符，包括字母数字下划线'
      return false
      }
    if(!/^\w{6,10}$/.test($('.modal-login input[name=password]').value)){
     $('.modal-login .errormsg').innerText = '密码需输入6-10个字符，包括字母数字下划线' 
     return false
    }
    this.submit()
  })
  
    $('.modal-register form').addEventListener("submit",function(e){
    e.preventDefault();
    if(!/^\w{3,8}$/.test($('.modal-login input[name=username]').value)){
      $('.modal-login .errormsg').innerText = '用户名需输入3-8个字符，包括字母数字下划线'
      return false
    }
    if(/^hunger$|^ruoyu$/.test($('.model-register input[name=password]').value)){
      $('.modal-register.errormsg').innerText = '用户名已存在'
      return false
    }
    if(!/^\w{6,10}$/.test($('.modal-login input[name=password]').value)){
     $('.modal-login .errormsg').innerText = '密码需输入6-10个字符，包括字母数字下划线' 
     return false
    }
    if($('.modal-register input[name=password]').value !== $('.modal-register input[name=password2]').value){
      $('.modal-register .errormsg').innerText='两次输入密码不一致'
      return false
    }
    this.submit()
  })
   
   </script>
</body>
</html>